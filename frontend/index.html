<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>National Document Registry | Blockchain Secured</title>
  
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
  <script src="config.js"></script> 

  <style>
    /* OFFICIAL GOVERNMENT THEME */
    :root {
        --primary: #2c3e50;    /* Dark Blue */
        --accent: #c0392b;     /* Red */
        --gold: #f39c12;       /* Gold */
        --light: #f4f1ea;      /* Paper Color */
        --success: #27ae60;    /* Green */
        --text: #333;
    }

    body {
        font-family: "Times New Roman", Times, serif;
        background-color: var(--light);
        margin: 0;
        padding: 0;
        color: var(--text);
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    /* HEADER */
    header {
        background: var(--primary);
        color: white;
        width: 100%;
        padding: 25px 0;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        border-bottom: 5px solid var(--gold);
    }
    
    header h1 { margin: 0; letter-spacing: 2px; text-transform: uppercase; font-size: 1.8rem; }
    header p { margin: 8px 0 0; font-style: italic; opacity: 0.8; font-size: 0.95rem; }

    /* LAYOUT UTILS */
    .container {
        width: 1000px;
        max-width: 90%;
        margin: 40px auto;
        display: flex;
        flex-direction: column;
        gap: 50px;
    }
    
    .section-title {
        text-align: center;
        color: var(--primary);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 20px;
        border-bottom: 2px solid #ddd;
        display: inline-block;
        padding-bottom: 10px;
    }

    /* 1. INSTANT SEARCH BAR */
    .search-section {
        background: white;
        padding: 40px;
        border: 1px solid #ccc;
        box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        text-align: center;
        position: relative;
        border-radius: 4px;
    }
    .search-section::before {
        content: "‚ö° PUBLIC ACCESS";
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--gold);
        color: white;
        padding: 2px 15px;
        font-size: 0.8rem;
        font-weight: bold;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .search-bar { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
    
    input {
        padding: 15px;
        width: 60%;
        border: 2px solid #ddd;
        font-size: 1.1rem;
        font-family: monospace;
        transition: border 0.3s;
    }
    input:focus { outline: none; border-color: var(--primary); }

    .btn-verify {
        background: var(--primary);
        color: white;
        border: none;
        padding: 0 30px;
        cursor: pointer;
        font-weight: bold;
        text-transform: uppercase;
        font-size: 1rem;
        transition: background 0.3s;
    }
    .btn-verify:hover { background: #1a252f; }

    /* SEARCH RESULTS */
    #quickResult {
        display: none;
        margin-top: 25px;
        padding: 20px;
        border: 1px solid #ddd;
        background: #fdfdfd;
        text-align: left;
        animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    .result-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #eee; }
    .label { font-weight: bold; color: #555; }
    .value { font-family: monospace; color: #000; }
    .badge { padding: 5px 12px; border-radius: 4px; color: white; font-weight: bold; font-size: 0.85rem; }
    .valid { background: var(--success); }
    .invalid { background: var(--accent); }

    /* 2. HOW IT WORKS (Visual Guide) */
    .steps-grid {
        display: flex;
        gap: 20px;
        text-align: center;
    }
    .step-card {
        flex: 1;
        background: white;
        padding: 25px;
        border: 1px solid #eee;
        border-bottom: 3px solid var(--primary);
    }
    .step-icon { font-size: 2.5rem; margin-bottom: 15px; display: block; }
    .step-card h4 { margin: 10px 0; color: var(--primary); }
    .step-card p { font-size: 0.9rem; color: #666; line-height: 1.4; }

    /* 3. ROLES (Login Area) */
    .roles-grid { display: flex; gap: 30px; justify-content: center; }
    
    .card {
        flex: 1;
        background: white;
        padding: 30px;
        border: 1px solid #ddd;
        text-align: center;
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        border-color: var(--primary);
    }
    
    .card h3 { margin: 10px 0; color: var(--primary); text-transform: uppercase; border-bottom: 2px double #eee; padding-bottom: 10px; }
    .btn-role {
        display: inline-block;
        margin-top: 15px;
        padding: 10px 20px;
        border: 1px solid var(--primary);
        color: var(--primary);
        text-decoration: none;
        font-weight: bold;
        transition: all 0.2s;
    }
    .card:hover .btn-role { background: var(--primary); color: white; }

    /* FOOTER */
    footer {
        background: #222;
        color: #aaa;
        width: 100%;
        padding: 40px 0;
        margin-top: auto;
        font-size: 0.9rem;
        text-align: center;
    }
    .footer-links { margin-bottom: 20px; }
    .footer-links a { color: #fff; text-decoration: none; margin: 0 15px; }
    .footer-links a:hover { text-decoration: underline; color: var(--gold); }
    
    .trust-strip {
        background: #111;
        color: #666;
        padding: 10px;
        font-size: 0.8rem;
        display: flex;
        justify-content: center;
        gap: 30px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

  </style>
</head>
<body>

  <header>
    <h1>üèõÔ∏è National Document Registry</h1>
    <p>Official Blockchain Verification Portal</p>
  </header>

  <div class="container">

    <div class="search-section">
        <h2 style="margin-top: 0; text-transform: uppercase; font-size: 1.4rem; color: var(--primary);">Instant Authenticity Check</h2>
        <p style="font-size: 1rem; color: #666;">Enter a unique Document Hash to verify its integrity on the Ethereum Ledger.</p>
        
        <div class="search-bar">
            <input type="text" id="quickHash" placeholder="Paste Document Hash (e.g. 0x8a7f...)" />
            <button class="btn-verify" onclick="quickVerify()">Verify Now</button>
        </div>

        <div id="quickResult">
            <div style="text-align: center; margin-bottom: 15px;">
                <span id="statusBadge" class="badge">Checking...</span>
            </div>
            <div class="result-row">
                <span class="label">üìÖ Registered On:</span>
                <span class="value" id="resDate">--</span>
            </div>
            <div class="result-row">
                <span class="label">üë§ Issuer ID:</span>
                <span class="value" id="resIssuer">--</span>
            </div>
            <p style="font-size:0.8rem; color:#999; margin-top:10px; text-align:center;">
                *Issuer ID represents the official Blockchain Wallet Address of the uploading authority.
            </p>
        </div>
    </div>

    <div>
        <div style="text-align:center;"><span class="section-title">How It Works</span></div>
        <div class="steps-grid">
            <div class="step-card">
                <span class="step-icon">üìÑ</span>
                <h4>1. Upload</h4>
                <p>Authorities upload documents. We calculate a cryptographic hash (digital fingerprint) unique to the file.</p>
            </div>
            <div class="step-card">
                <span class="step-icon">üîó</span>
                <h4>2. Secure</h4>
                <p>The hash is permanently stored on the Ethereum Blockchain. The file itself is secured on IPFS.</p>
            </div>
            <div class="step-card">
                <span class="step-icon">‚úÖ</span>
                <h4>3. Verify</h4>
                <p>Anyone can verify a document instantly by comparing its hash against the immutable blockchain record.</p>
            </div>
        </div>
    </div>

    <div>
        <div style="text-align:center;"><span class="section-title">Select Your Role</span></div>
        <div class="roles-grid">
            <div class="card" onclick="window.location.href='auth.html'">
                <span class="step-icon">üéì</span>
                <h3>Authority Login</h3>
                <p>For Universities & Govt Bodies.<br>Issue, Revoke, and Manage Certificates.</p>
                <a href="auth.html" class="btn-role">Access Dashboard</a>
            </div>

            <div class="card" onclick="window.location.href='auth.html'">
                <span class="step-icon">üîç</span>
                <h3>Advanced Verifier</h3>
                <p>For Employers & Embassies.<br>Upload files to check against the registry.</p>
                <a href="auth.html" class="btn-role">Login to Verify</a>
            </div>
        </div>
    </div>

  </div>

  <footer>
      <div class="footer-links">
          <a href="#">Home</a>
          <a href="#">About the Registry</a>
          <a href="#">Legal Framework</a>
          <a href="#">Contact Support</a>
      </div>
      <p>&copy; 2026 National Document Registry. Secured by Ethereum Blockchain.</p>
  </footer>
  
  <div class="trust-strip">
      <span>üîí AES-256 Encrypted</span>
      <span>‚òÅÔ∏è IPFS Storage</span>
      <span>‚õìÔ∏è Ethereum Network</span>
  </div>

  <script>
      async function quickVerify() {
          const hashInput = document.getElementById("quickHash").value.trim();
          const resultBox = document.getElementById("quickResult");
          const badge = document.getElementById("statusBadge");
          const resDate = document.getElementById("resDate");
          const resIssuer = document.getElementById("resIssuer");

          if (!hashInput) { alert("Please enter a hash."); return; }
          if (typeof CONFIG === 'undefined') { alert("Error: Config not loaded."); return; }

          resultBox.style.display = "block";
          badge.className = "badge";
          badge.style.background = "#95a5a6"; 
          badge.innerText = "üîç Scanning Blockchain...";
          resDate.innerText = "--";
          resIssuer.innerText = "--";

          if (!window.ethereum) {
              alert("MetaMask is required for public verification.");
              return;
          }

          try {
              const provider = new ethers.BrowserProvider(window.ethereum);
              const contract = new ethers.Contract(CONFIG.CONTRACT_ADDRESS, [
                  "function getCid(bytes32 _fileHash) view returns (string)",
                  "event DocumentRegistered(bytes32 indexed fileHash, string ipfsCid, address owner)"
              ], provider);

              let formattedHash = hashInput.startsWith("0x") ? hashInput : "0x" + hashInput;

              // 1. Check if Valid
              const cid = await contract.getCid(formattedHash);
              
              if (!cid || cid === "") {
                  badge.className = "badge invalid";
                  badge.innerText = "‚ùå INVALID / NOT FOUND";
                  resDate.innerText = "N/A";
                  resIssuer.innerText = "N/A";
              } else {
                  badge.className = "badge valid";
                  badge.innerText = "‚úÖ AUTHENTIC DOCUMENT";
                  
                  // Scan for details (Limit to last 50k blocks for speed)
                  const currentBlock = await provider.getBlockNumber();
                  const startBlock = Math.max(0, currentBlock - 50000);
                  
                  const filter = contract.filters.DocumentRegistered(formattedHash);
                  const events = await contract.queryFilter(filter, startBlock, currentBlock);

                  if (events.length > 0) {
                      const event = events[0];
                      const block = await provider.getBlock(event.blockNumber);
                      const date = new Date(block.timestamp * 1000).toLocaleString();
                      
                      resDate.innerText = date;
                      resIssuer.innerText = event.args[2];
                  } else {
                      resDate.innerText = "Verified (Archived)";
                      resIssuer.innerText = "Verified Authority";
                  }
              }

          } catch (error) {
              console.error(error);
              badge.className = "badge invalid";
              badge.innerText = "‚ö†Ô∏è ERROR";
          }
      }
  </script>

</body>
</html>